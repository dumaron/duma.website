{{ $src := .Page.Resources.GetMatch (printf "*%s*" (.Get "src")) }}
{{ $tinyw := default "1000x" }}
{{ .Scratch.Set "tiny" ($src.Resize $tinyw) }}
{{ $tiny := .Scratch.Get "tiny" }}

<figure>
  <img 
    src="{{ $tiny.RelPermalink }}" 
    {{ with .Get "alt" }}alt="{{.}}"{{ else }}alt=""{{ end }} 
  />
  {{ with .Get "caption"}}<figcaption>{{ . | safeHTML }}</figcaption>{{ end }}
</figure>